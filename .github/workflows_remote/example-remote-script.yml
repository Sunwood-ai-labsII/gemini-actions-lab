name: 'ðŸ“š Example: Using Remote Scripts'

# ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ã„æ–¹ã‚’ç¤ºã™ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€œâœ¨
# å®Ÿéš›ã®é‹ç”¨ã§ã¯ã€å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã—ã¦ã­ï¼

on:
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œç”¨
    inputs:
      script_name:
        description: 'Script to download and test'
        required: true
        type: choice
        options:
          - build_reviewer_prompt.py
          - clamp_diff.py
          - ensure_hf_space.py
        default: 'build_reviewer_prompt.py'

permissions:
  contents: read

jobs:
  test-remote-script:
    runs-on: ubuntu-latest
    env:
      REMOTE_REPO: 'Sunwood-ai-labsII/gemini-actions-lab'
      REMOTE_BRANCH: 'main'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download remote script
        env:
          SCRIPT_NAME: ${{ github.event.inputs.script_name }}
        run: |
          set -euo pipefail
          
          echo "ðŸš€ Downloading ${SCRIPT_NAME} from remote repository..."
          
          mkdir -p /tmp/remote-scripts
          SCRIPT_URL="https://raw.githubusercontent.com/${REMOTE_REPO}/${REMOTE_BRANCH}/.github/scripts/${SCRIPT_NAME}"
          
          echo "ðŸ“ URL: ${SCRIPT_URL}"
          
          if ! curl -fsSL "${SCRIPT_URL}" -o "/tmp/remote-scripts/${SCRIPT_NAME}"; then
            echo "âŒ Failed to download script"
            exit 1
          fi
          
          chmod +x "/tmp/remote-scripts/${SCRIPT_NAME}"
          echo "âœ… Successfully downloaded: ${SCRIPT_NAME}"
          
          # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å†…å®¹ç¢ºèªï¼ˆæœ€åˆã®10è¡Œï¼‰
          echo ""
          echo "ðŸ“ Script preview (first 10 lines):"
          head -10 "/tmp/remote-scripts/${SCRIPT_NAME}"

      - name: Verify script
        env:
          SCRIPT_NAME: ${{ github.event.inputs.script_name }}
        run: |
          set -euo pipefail
          
          echo "ðŸ” Verifying script..."
          
          # ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          if [ ! -f "/tmp/remote-scripts/${SCRIPT_NAME}" ]; then
            echo "âŒ Script file not found"
            exit 1
          fi
          
          # Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å ´åˆã¯æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
          if [[ "${SCRIPT_NAME}" == *.py ]]; then
            echo "ðŸ Checking Python syntax..."
            python3 -m py_compile "/tmp/remote-scripts/${SCRIPT_NAME}"
            echo "âœ… Python syntax is valid"
          fi
          
          # ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
          echo ""
          echo "ðŸ“Š File info:"
          ls -lh "/tmp/remote-scripts/${SCRIPT_NAME}"
          echo ""
          echo "ðŸŽ¯ MD5 checksum:"
          md5sum "/tmp/remote-scripts/${SCRIPT_NAME}"

      - name: Test script (basic)
        env:
          SCRIPT_NAME: ${{ github.event.inputs.script_name }}
        run: |
          set -euo pipefail
          
          echo "ðŸ§ª Running basic test..."
          
          case "${SCRIPT_NAME}" in
            "build_reviewer_prompt.py")
              echo "ðŸ“ Testing build_reviewer_prompt.py..."
              # ãƒ˜ãƒ«ãƒ—ã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒã‚ã‚Œã°è¡¨ç¤º
              python3 "/tmp/remote-scripts/${SCRIPT_NAME}" --help || echo "No help available"
              ;;
              
            "clamp_diff.py")
              echo "âœ‚ï¸ Testing clamp_diff.py..."
              # ã‚·ãƒ³ãƒ—ãƒ«ãªå…¥åŠ›ã§ãƒ†ã‚¹ãƒˆ
              echo -e "line1\nline2\nline3\nline4\nline5" | \
                python3 "/tmp/remote-scripts/${SCRIPT_NAME}" 3 100
              ;;
              
            "ensure_hf_space.py")
              echo "ðŸ¤— Testing ensure_hf_space.py..."
              python3 "/tmp/remote-scripts/${SCRIPT_NAME}" --help || echo "No help available"
              ;;
              
            *)
              echo "âš ï¸ No specific test defined for ${SCRIPT_NAME}"
              ;;
          esac
          
          echo "âœ… Test completed!"

      - name: Summary
        run: |
          echo "## ðŸŽ€ Remote Script Test Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ¨ Successfully tested remote script download and execution!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Repository**: ${REMOTE_REPO}" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch**: ${REMOTE_BRANCH}" >> $GITHUB_STEP_SUMMARY
          echo "- **Script**: ${{ github.event.inputs.script_name }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ã‚ˆãã€œï¼ðŸ’•" >> $GITHUB_STEP_SUMMARY
